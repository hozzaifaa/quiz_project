<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Class Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .card { margin-bottom: 20px; }
    .feedback { margin-top: 10px; font-size: 0.95rem; }
    .correct { color: green; font-weight: bold; }
    .wrong { color: red; font-weight: bold; }
    #scoreBox { margin-top: 20px; font-size: 1.2rem; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center mb-4">üìò Class Quiz</h1>
    <div id="quiz-container"></div>

    <div class="text-center mt-4">
      <button id="finishBtn" class="btn btn-success me-2">Finish & Score</button>
      <button id="showAllBtn" class="btn btn-info me-2">Show All Answers</button>
      <button id="resetBtn" class="btn btn-secondary">Reset</button>
    </div>

    <div id="scoreBox" class="text-center"></div>
  </div>

  <!-- Questions file -->
  <script src="json.js"></script>

  <script>
    const container = document.getElementById('quiz-container');
    const finishBtn = document.getElementById('finishBtn');
    const showAllBtn = document.getElementById('showAllBtn');
    const resetBtn = document.getElementById('resetBtn');
    const scoreBox = document.getElementById('scoreBox');

    // Shuffle helper
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz() {
      container.innerHTML = '';
      window.quiz = shuffle(window.quiz); // shuffle questions
      window.quiz.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'card p-3 shadow-sm';

        const qTitle = document.createElement('h5');
        qTitle.innerHTML = `Q${idx + 1}: ${q.question}`;
        card.appendChild(qTitle);

        // shuffle options too
        shuffle(q.options).forEach(opt => {
          const div = document.createElement('div');
          div.className = 'form-check';
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = 'q' + idx;
          input.value = opt;
          input.className = 'form-check-input';
          const label = document.createElement('label');
          label.className = 'form-check-label';
          label.textContent = opt;
          div.appendChild(input);
          div.appendChild(label);
          card.appendChild(div);
        });

        const feedback = document.createElement('div');
        feedback.className = 'feedback text-muted';
        feedback.textContent = 'No answer yet.';
        card.appendChild(feedback);

        container.appendChild(card);
      });
    }

    function gradeQuiz() {
      let correct = 0;
      window.quiz.forEach((q, idx) => {
        const card = container.children[idx];
        const selected = card.querySelector('input[type=radio]:checked');
        const feedback = card.querySelector('.feedback');

        if (selected && selected.value === q.answer) {
          correct++;
          feedback.className = 'feedback correct';
          feedback.textContent = '‚úÖ Correct!';
        } else {
          feedback.className = 'feedback wrong';
          feedback.innerHTML = `‚ùå Wrong. Correct: <b>${q.answer}</b><br><small>${q.explain || ''}</small>`;
        }
      });
      scoreBox.textContent = `Final Score: ${correct} / ${window.quiz.length}`;
    }

    function showAllAnswers() {
      window.quiz.forEach((q, idx) => {
        const card = container.children[idx];
        const feedback = card.querySelector('.feedback');
        feedback.className = 'feedback correct';
        feedback.innerHTML = `‚úÖ Correct answer: <b>${q.answer}</b><br><small>${q.explain || ''}</small>`;
      });
    }

    function resetQuiz() {
      scoreBox.textContent = '';
      renderQuiz();
    }

    finishBtn.onclick = gradeQuiz;
    showAllBtn.onclick = showAllAnswers;
    resetBtn.onclick = resetQuiz;

    renderQuiz();
  </script>
</body>
</html>
